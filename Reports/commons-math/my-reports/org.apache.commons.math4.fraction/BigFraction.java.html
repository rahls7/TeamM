<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BigFraction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Apache Commons Math</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.math4.fraction</a> &gt; <span class="el_source">BigFraction.java</span></div><h1>BigFraction.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.math4.fraction;

import java.io.Serializable;
import java.math.BigDecimal;
import java.math.BigInteger;

import org.apache.commons.math4.FieldElement;
import org.apache.commons.math4.exception.MathArithmeticException;
import org.apache.commons.math4.exception.MathIllegalArgumentException;
import org.apache.commons.math4.exception.NullArgumentException;
import org.apache.commons.math4.exception.ZeroException;
import org.apache.commons.math4.exception.util.LocalizedFormats;
import org.apache.commons.numbers.core.ArithmeticUtils;
import org.apache.commons.math4.util.FastMath;
import org.apache.commons.math4.util.MathUtils;

/**
 * Representation of a rational number without any overflow. This class is
 * immutable.
 *
 * @since 2.0
 */
public class BigFraction
    extends Number
    implements FieldElement&lt;BigFraction&gt;, Comparable&lt;BigFraction&gt;, Serializable {

    /** A fraction representing &quot;2 / 1&quot;. */
<span class="fc" id="L44">    public static final BigFraction TWO = new BigFraction(2);</span>

    /** A fraction representing &quot;1&quot;. */
<span class="fc" id="L47">    public static final BigFraction ONE = new BigFraction(1);</span>

    /** A fraction representing &quot;0&quot;. */
<span class="fc" id="L50">    public static final BigFraction ZERO = new BigFraction(0);</span>

    /** A fraction representing &quot;-1 / 1&quot;. */
<span class="fc" id="L53">    public static final BigFraction MINUS_ONE = new BigFraction(-1);</span>

    /** A fraction representing &quot;4/5&quot;. */
<span class="fc" id="L56">    public static final BigFraction FOUR_FIFTHS = new BigFraction(4, 5);</span>

    /** A fraction representing &quot;1/5&quot;. */
<span class="fc" id="L59">    public static final BigFraction ONE_FIFTH = new BigFraction(1, 5);</span>

    /** A fraction representing &quot;1/2&quot;. */
<span class="fc" id="L62">    public static final BigFraction ONE_HALF = new BigFraction(1, 2);</span>

    /** A fraction representing &quot;1/4&quot;. */
<span class="fc" id="L65">    public static final BigFraction ONE_QUARTER = new BigFraction(1, 4);</span>

    /** A fraction representing &quot;1/3&quot;. */
<span class="fc" id="L68">    public static final BigFraction ONE_THIRD = new BigFraction(1, 3);</span>

    /** A fraction representing &quot;3/5&quot;. */
<span class="fc" id="L71">    public static final BigFraction THREE_FIFTHS = new BigFraction(3, 5);</span>

    /** A fraction representing &quot;3/4&quot;. */
<span class="fc" id="L74">    public static final BigFraction THREE_QUARTERS = new BigFraction(3, 4);</span>

    /** A fraction representing &quot;2/5&quot;. */
<span class="fc" id="L77">    public static final BigFraction TWO_FIFTHS = new BigFraction(2, 5);</span>

    /** A fraction representing &quot;2/4&quot;. */
<span class="fc" id="L80">    public static final BigFraction TWO_QUARTERS = new BigFraction(2, 4);</span>

    /** A fraction representing &quot;2/3&quot;. */
<span class="fc" id="L83">    public static final BigFraction TWO_THIRDS = new BigFraction(2, 3);</span>

    /** Serializable version identifier. */
    private static final long serialVersionUID = -5630213147331578515L;

    /** &lt;code&gt;BigInteger&lt;/code&gt; representation of 100. */
<span class="fc" id="L89">    private static final BigInteger ONE_HUNDRED = BigInteger.valueOf(100);</span>

    /** The numerator. */
    private final BigInteger numerator;

    /** The denominator. */
    private final BigInteger denominator;

    /**
     * &lt;p&gt;
     * Create a {@link BigFraction} equivalent to the passed {@code BigInteger}, ie
     * &quot;num / 1&quot;.
     * &lt;/p&gt;
     *
     * @param num
     *            the numerator.
     */
    public BigFraction(final BigInteger num) {
<span class="fc" id="L107">        this(num, BigInteger.ONE);</span>
<span class="fc" id="L108">    }</span>

    /**
     * Create a {@link BigFraction} given the numerator and denominator as
     * {@code BigInteger}. The {@link BigFraction} is reduced to lowest terms.
     *
     * @param num the numerator, must not be {@code null}.
     * @param den the denominator, must not be {@code null}.
     * @throws ZeroException if the denominator is zero.
     * @throws NullArgumentException if either of the arguments is null
     */
<span class="fc" id="L119">    public BigFraction(BigInteger num, BigInteger den) {</span>
<span class="fc" id="L120">        MathUtils.checkNotNull(num, LocalizedFormats.NUMERATOR);</span>
<span class="fc" id="L121">        MathUtils.checkNotNull(den, LocalizedFormats.DENOMINATOR);</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">        if (den.signum() == 0) {</span>
<span class="fc" id="L123">            throw new ZeroException(LocalizedFormats.ZERO_DENOMINATOR);</span>
        }
<span class="fc bfc" id="L125" title="All 2 branches covered.">        if (num.signum() == 0) {</span>
<span class="fc" id="L126">            numerator   = BigInteger.ZERO;</span>
<span class="fc" id="L127">            denominator = BigInteger.ONE;</span>
        } else {

            // reduce numerator and denominator by greatest common denominator
<span class="fc" id="L131">            final BigInteger gcd = num.gcd(den);</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">            if (BigInteger.ONE.compareTo(gcd) &lt; 0) {</span>
<span class="fc" id="L133">                num = num.divide(gcd);</span>
<span class="fc" id="L134">                den = den.divide(gcd);</span>
            }

            // move sign to numerator
<span class="fc bfc" id="L138" title="All 2 branches covered.">            if (den.signum() == -1) {</span>
<span class="fc" id="L139">                num = num.negate();</span>
<span class="fc" id="L140">                den = den.negate();</span>
            }

            // store the values in the final fields
<span class="fc" id="L144">            numerator   = num;</span>
<span class="fc" id="L145">            denominator = den;</span>

        }
<span class="fc" id="L148">    }</span>

    /**
     * Create a fraction given the double value.
     * &lt;p&gt;
     * This constructor behaves &lt;em&gt;differently&lt;/em&gt; from
     * {@link #BigFraction(double, double, int)}. It converts the double value
     * exactly, considering its internal bits representation. This works for all
     * values except NaN and infinities and does not requires any loop or
     * convergence threshold.
     * &lt;/p&gt;
     * &lt;p&gt;
     * Since this conversion is exact and since double numbers are sometimes
     * approximated, the fraction created may seem strange in some cases. For example,
     * calling &lt;code&gt;new BigFraction(1.0 / 3.0)&lt;/code&gt; does &lt;em&gt;not&lt;/em&gt; create
     * the fraction 1/3, but the fraction 6004799503160661 / 18014398509481984
     * because the double number passed to the constructor is not exactly 1/3
     * (this number cannot be stored exactly in IEEE754).
     * &lt;/p&gt;
     * @see #BigFraction(double, double, int)
     * @param value the double value to convert to a fraction.
     * @exception MathIllegalArgumentException if value is NaN or infinite
     */
<span class="fc" id="L171">    public BigFraction(final double value) throws MathIllegalArgumentException {</span>
<span class="fc bfc" id="L172" title="All 2 branches covered.">        if (Double.isNaN(value)) {</span>
<span class="fc" id="L173">            throw new MathIllegalArgumentException(LocalizedFormats.NAN_VALUE_CONVERSION);</span>
        }
<span class="fc bfc" id="L175" title="All 2 branches covered.">        if (Double.isInfinite(value)) {</span>
<span class="fc" id="L176">            throw new MathIllegalArgumentException(LocalizedFormats.INFINITE_VALUE_CONVERSION);</span>
        }

        // compute m and k such that value = m * 2^k
<span class="fc" id="L180">        final long bits     = Double.doubleToLongBits(value);</span>
<span class="fc" id="L181">        final long sign     = bits &amp; 0x8000000000000000L;</span>
<span class="fc" id="L182">        final long exponent = bits &amp; 0x7ff0000000000000L;</span>
<span class="fc" id="L183">        long m              = bits &amp; 0x000fffffffffffffL;</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">        if (exponent != 0) {</span>
            // this was a normalized number, add the implicit most significant bit
<span class="fc" id="L186">            m |= 0x0010000000000000L;</span>
        }
<span class="fc bfc" id="L188" title="All 2 branches covered.">        if (sign != 0) {</span>
<span class="fc" id="L189">            m = -m;</span>
        }
<span class="fc" id="L191">        int k = ((int) (exponent &gt;&gt; 52)) - 1075;</span>
<span class="fc bfc" id="L192" title="All 4 branches covered.">        while (((m &amp; 0x001ffffffffffffeL) != 0) &amp;&amp; ((m &amp; 0x1) == 0)) {</span>
<span class="fc" id="L193">            m &gt;&gt;= 1;</span>
<span class="fc" id="L194">            ++k;</span>
        }

<span class="fc bfc" id="L197" title="All 2 branches covered.">        if (k &lt; 0) {</span>
<span class="fc" id="L198">            numerator   = BigInteger.valueOf(m);</span>
<span class="fc" id="L199">            denominator = BigInteger.ZERO.flipBit(-k);</span>
        } else {
<span class="fc" id="L201">            numerator   = BigInteger.valueOf(m).multiply(BigInteger.ZERO.flipBit(k));</span>
<span class="fc" id="L202">            denominator = BigInteger.ONE;</span>
        }

<span class="fc" id="L205">    }</span>

    /**
     * Create a fraction given the double value and maximum error allowed.
     * &lt;p&gt;
     * References:
     * &lt;ul&gt;
     * &lt;li&gt;&lt;a href=&quot;http://mathworld.wolfram.com/ContinuedFraction.html&quot;&gt;
     * Continued Fraction&lt;/a&gt; equations (11) and (22)-(26)&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param value
     *            the double value to convert to a fraction.
     * @param epsilon
     *            maximum error allowed. The resulting fraction is within
     *            &lt;code&gt;epsilon&lt;/code&gt; of &lt;code&gt;value&lt;/code&gt;, in absolute terms.
     * @param maxIterations
     *            maximum number of convergents.
     * @throws FractionConversionException
     *             if the continued fraction failed to converge.
     * @see #BigFraction(double)
     */
    public BigFraction(final double value, final double epsilon,
                       final int maxIterations)
        throws FractionConversionException {
<span class="fc" id="L230">        this(value, epsilon, Integer.MAX_VALUE, maxIterations);</span>
<span class="fc" id="L231">    }</span>

    /**
     * Create a fraction given the double value and either the maximum error
     * allowed or the maximum number of denominator digits.
     * &lt;p&gt;
     *
     * NOTE: This constructor is called with EITHER - a valid epsilon value and
     * the maxDenominator set to Integer.MAX_VALUE (that way the maxDenominator
     * has no effect). OR - a valid maxDenominator value and the epsilon value
     * set to zero (that way epsilon only has effect if there is an exact match
     * before the maxDenominator value is reached).
     * &lt;/p&gt;
     * &lt;p&gt;
     *
     * It has been done this way so that the same code can be (re)used for both
     * scenarios. However this could be confusing to users if it were part of
     * the public API and this constructor should therefore remain PRIVATE.
     * &lt;/p&gt;
     *
     * See JIRA issue ticket MATH-181 for more details:
     *
     * https://issues.apache.org/jira/browse/MATH-181
     *
     * @param value
     *            the double value to convert to a fraction.
     * @param epsilon
     *            maximum error allowed. The resulting fraction is within
     *            &lt;code&gt;epsilon&lt;/code&gt; of &lt;code&gt;value&lt;/code&gt;, in absolute terms.
     * @param maxDenominator
     *            maximum denominator value allowed.
     * @param maxIterations
     *            maximum number of convergents.
     * @throws FractionConversionException
     *             if the continued fraction failed to converge.
     */
    private BigFraction(final double value, final double epsilon,
                        final int maxDenominator, int maxIterations)
<span class="fc" id="L269">        throws FractionConversionException {</span>
<span class="fc" id="L270">        long overflow = Integer.MAX_VALUE;</span>
<span class="fc" id="L271">        double r0 = value;</span>
<span class="fc" id="L272">        long a0 = (long) FastMath.floor(r0);</span>

<span class="fc bfc" id="L274" title="All 2 branches covered.">        if (FastMath.abs(a0) &gt; overflow) {</span>
<span class="fc" id="L275">            throw new FractionConversionException(value, a0, 1l);</span>
        }

        // check for (almost) integer arguments, which should not go
        // to iterations.
<span class="fc bfc" id="L280" title="All 2 branches covered.">        if (FastMath.abs(a0 - value) &lt; epsilon) {</span>
<span class="fc" id="L281">            numerator = BigInteger.valueOf(a0);</span>
<span class="fc" id="L282">            denominator = BigInteger.ONE;</span>
<span class="fc" id="L283">            return;</span>
        }

<span class="fc" id="L286">        long p0 = 1;</span>
<span class="fc" id="L287">        long q0 = 0;</span>
<span class="fc" id="L288">        long p1 = a0;</span>
<span class="fc" id="L289">        long q1 = 1;</span>

<span class="fc" id="L291">        long p2 = 0;</span>
<span class="fc" id="L292">        long q2 = 1;</span>

<span class="fc" id="L294">        int n = 0;</span>
<span class="fc" id="L295">        boolean stop = false;</span>
        do {
<span class="fc" id="L297">            ++n;</span>
<span class="fc" id="L298">            final double r1 = 1.0 / (r0 - a0);</span>
<span class="fc" id="L299">            final long a1 = (long) FastMath.floor(r1);</span>
<span class="fc" id="L300">            p2 = (a1 * p1) + p0;</span>
<span class="fc" id="L301">            q2 = (a1 * q1) + q0;</span>
<span class="pc bpc" id="L302" title="1 of 4 branches missed.">            if ((p2 &gt; overflow) || (q2 &gt; overflow)) {</span>
                // in maxDenominator mode, if the last fraction was very close to the actual value
                // q2 may overflow in the next iteration; in this case return the last one.
<span class="pc bpc" id="L305" title="2 of 4 branches missed.">                if (epsilon == 0.0 &amp;&amp; FastMath.abs(q1) &lt; maxDenominator) {</span>
<span class="fc" id="L306">                    break;</span>
                }
<span class="nc" id="L308">                throw new FractionConversionException(value, p2, q2);</span>
            }

<span class="fc" id="L311">            final double convergent = (double) p2 / (double) q2;</span>
<span class="fc bfc" id="L312" title="All 2 branches covered.">            if ((n &lt; maxIterations) &amp;&amp;</span>
<span class="fc bfc" id="L313" title="All 4 branches covered.">                (FastMath.abs(convergent - value) &gt; epsilon) &amp;&amp;</span>
                (q2 &lt; maxDenominator)) {
<span class="fc" id="L315">                p0 = p1;</span>
<span class="fc" id="L316">                p1 = p2;</span>
<span class="fc" id="L317">                q0 = q1;</span>
<span class="fc" id="L318">                q1 = q2;</span>
<span class="fc" id="L319">                a0 = a1;</span>
<span class="fc" id="L320">                r0 = r1;</span>
            } else {
<span class="fc" id="L322">                stop = true;</span>
            }
<span class="fc bfc" id="L324" title="All 2 branches covered.">        } while (!stop);</span>

<span class="fc bfc" id="L326" title="All 2 branches covered.">        if (n &gt;= maxIterations) {</span>
<span class="fc" id="L327">            throw new FractionConversionException(value, maxIterations);</span>
        }

<span class="fc bfc" id="L330" title="All 2 branches covered.">        if (q2 &lt; maxDenominator) {</span>
<span class="fc" id="L331">            numerator   = BigInteger.valueOf(p2);</span>
<span class="fc" id="L332">            denominator = BigInteger.valueOf(q2);</span>
        } else {
<span class="fc" id="L334">            numerator   = BigInteger.valueOf(p1);</span>
<span class="fc" id="L335">            denominator = BigInteger.valueOf(q1);</span>
        }
<span class="fc" id="L337">    }</span>

    /**
     * Create a fraction given the double value and maximum denominator.
     * &lt;p&gt;
     * References:
     * &lt;ul&gt;
     * &lt;li&gt;&lt;a href=&quot;http://mathworld.wolfram.com/ContinuedFraction.html&quot;&gt;
     * Continued Fraction&lt;/a&gt; equations (11) and (22)-(26)&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param value
     *            the double value to convert to a fraction.
     * @param maxDenominator
     *            The maximum allowed value for denominator.
     * @throws FractionConversionException
     *             if the continued fraction failed to converge.
     */
    public BigFraction(final double value, final int maxDenominator)
        throws FractionConversionException {
<span class="fc" id="L357">        this(value, 0, maxDenominator, 100);</span>
<span class="fc" id="L358">    }</span>

    /**
     * &lt;p&gt;
     * Create a {@link BigFraction} equivalent to the passed {@code int}, ie
     * &quot;num / 1&quot;.
     * &lt;/p&gt;
     *
     * @param num
     *            the numerator.
     */
    public BigFraction(final int num) {
<span class="fc" id="L370">        this(BigInteger.valueOf(num), BigInteger.ONE);</span>
<span class="fc" id="L371">    }</span>

    /**
     * &lt;p&gt;
     * Create a {@link BigFraction} given the numerator and denominator as simple
     * {@code int}. The {@link BigFraction} is reduced to lowest terms.
     * &lt;/p&gt;
     *
     * @param num
     *            the numerator.
     * @param den
     *            the denominator.
     */
    public BigFraction(final int num, final int den) {
<span class="fc" id="L385">        this(BigInteger.valueOf(num), BigInteger.valueOf(den));</span>
<span class="fc" id="L386">    }</span>

    /**
     * &lt;p&gt;
     * Create a {@link BigFraction} equivalent to the passed long, ie &quot;num / 1&quot;.
     * &lt;/p&gt;
     *
     * @param num
     *            the numerator.
     */
    public BigFraction(final long num) {
<span class="fc" id="L397">        this(BigInteger.valueOf(num), BigInteger.ONE);</span>
<span class="fc" id="L398">    }</span>

    /**
     * &lt;p&gt;
     * Create a {@link BigFraction} given the numerator and denominator as simple
     * {@code long}. The {@link BigFraction} is reduced to lowest terms.
     * &lt;/p&gt;
     *
     * @param num
     *            the numerator.
     * @param den
     *            the denominator.
     */
    public BigFraction(final long num, final long den) {
<span class="fc" id="L412">        this(BigInteger.valueOf(num), BigInteger.valueOf(den));</span>
<span class="fc" id="L413">    }</span>

    /**
     * &lt;p&gt;
     * Creates a &lt;code&gt;BigFraction&lt;/code&gt; instance with the 2 parts of a fraction
     * Y/Z.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Any negative signs are resolved to be on the numerator.
     * &lt;/p&gt;
     *
     * @param numerator
     *            the numerator, for example the three in 'three sevenths'.
     * @param denominator
     *            the denominator, for example the seven in 'three sevenths'.
     * @return a new fraction instance, with the numerator and denominator
     *         reduced.
     * @throws ArithmeticException
     *             if the denominator is &lt;code&gt;zero&lt;/code&gt;.
     */
    public static BigFraction getReducedFraction(final int numerator,
                                                 final int denominator) {
<span class="fc bfc" id="L436" title="All 2 branches covered.">        if (numerator == 0) {</span>
<span class="fc" id="L437">            return ZERO; // normalize zero.</span>
        }

<span class="fc" id="L440">        return new BigFraction(numerator, denominator);</span>
    }

    /**
     * &lt;p&gt;
     * Returns the absolute value of this {@link BigFraction}.
     * &lt;/p&gt;
     *
     * @return the absolute value as a {@link BigFraction}.
     */
    public BigFraction abs() {
<span class="fc bfc" id="L451" title="All 2 branches covered.">        return (numerator.signum() == 1) ? this : negate();</span>
    }

    /**
     * &lt;p&gt;
     * Adds the value of this fraction to the passed {@link BigInteger},
     * returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param bg
     *            the {@link BigInteger} to add, must'nt be &lt;code&gt;null&lt;/code&gt;.
     * @return a &lt;code&gt;BigFraction&lt;/code&gt; instance with the resulting values.
     * @throws NullArgumentException
     *             if the {@link BigInteger} is &lt;code&gt;null&lt;/code&gt;.
     */
    public BigFraction add(final BigInteger bg) throws NullArgumentException {
<span class="fc" id="L467">        MathUtils.checkNotNull(bg);</span>

<span class="pc bpc" id="L469" title="1 of 2 branches missed.">        if (numerator.signum() == 0) {</span>
<span class="nc" id="L470">            return new BigFraction(bg);</span>
        }
<span class="fc bfc" id="L472" title="All 2 branches covered.">        if (bg.signum() == 0) {</span>
<span class="fc" id="L473">            return this;</span>
        }

<span class="fc" id="L476">        return new BigFraction(numerator.add(denominator.multiply(bg)), denominator);</span>
    }

    /**
     * &lt;p&gt;
     * Adds the value of this fraction to the passed {@code integer}, returning
     * the result in reduced form.
     * &lt;/p&gt;
     *
     * @param i
     *            the {@code integer} to add.
     * @return a &lt;code&gt;BigFraction&lt;/code&gt; instance with the resulting values.
     */
    public BigFraction add(final int i) {
<span class="fc" id="L490">        return add(BigInteger.valueOf(i));</span>
    }

    /**
     * &lt;p&gt;
     * Adds the value of this fraction to the passed {@code long}, returning
     * the result in reduced form.
     * &lt;/p&gt;
     *
     * @param l
     *            the {@code long} to add.
     * @return a &lt;code&gt;BigFraction&lt;/code&gt; instance with the resulting values.
     */
    public BigFraction add(final long l) {
<span class="fc" id="L504">        return add(BigInteger.valueOf(l));</span>
    }

    /**
     * &lt;p&gt;
     * Adds the value of this fraction to another, returning the result in
     * reduced form.
     * &lt;/p&gt;
     *
     * @param fraction
     *            the {@link BigFraction} to add, must not be &lt;code&gt;null&lt;/code&gt;.
     * @return a {@link BigFraction} instance with the resulting values.
     * @throws NullArgumentException if the {@link BigFraction} is {@code null}.
     */
    @Override
    public BigFraction add(final BigFraction fraction) {
<span class="fc" id="L520">        MathUtils.checkNotNull(fraction, LocalizedFormats.FRACTION);</span>
<span class="fc bfc" id="L521" title="All 2 branches covered.">        if (fraction.numerator.signum() == 0) {</span>
<span class="fc" id="L522">            return this;</span>
        }
<span class="fc bfc" id="L524" title="All 2 branches covered.">        if (numerator.signum() == 0) {</span>
<span class="fc" id="L525">            return fraction;</span>
        }

<span class="fc" id="L528">        BigInteger num = null;</span>
<span class="fc" id="L529">        BigInteger den = null;</span>

<span class="fc bfc" id="L531" title="All 2 branches covered.">        if (denominator.equals(fraction.denominator)) {</span>
<span class="fc" id="L532">            num = numerator.add(fraction.numerator);</span>
<span class="fc" id="L533">            den = denominator;</span>
        } else {
<span class="fc" id="L535">            num = (numerator.multiply(fraction.denominator)).add((fraction.numerator).multiply(denominator));</span>
<span class="fc" id="L536">            den = denominator.multiply(fraction.denominator);</span>
        }

<span class="fc bfc" id="L539" title="All 2 branches covered.">        if (num.signum() == 0) {</span>
<span class="fc" id="L540">            return ZERO;</span>
        }

<span class="fc" id="L543">        return new BigFraction(num, den);</span>

    }

    /**
     * &lt;p&gt;
     * Gets the fraction as a &lt;code&gt;BigDecimal&lt;/code&gt;. This calculates the
     * fraction as the numerator divided by denominator.
     * &lt;/p&gt;
     *
     * @return the fraction as a &lt;code&gt;BigDecimal&lt;/code&gt;.
     * @throws ArithmeticException
     *             if the exact quotient does not have a terminating decimal
     *             expansion.
     * @see BigDecimal
     */
    public BigDecimal bigDecimalValue() {
<span class="fc" id="L560">        return new BigDecimal(numerator).divide(new BigDecimal(denominator));</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction as a &lt;code&gt;BigDecimal&lt;/code&gt; following the passed
     * rounding mode. This calculates the fraction as the numerator divided by
     * denominator.
     * &lt;/p&gt;
     *
     * @param roundingMode
     *            rounding mode to apply. see {@link BigDecimal} constants.
     * @return the fraction as a &lt;code&gt;BigDecimal&lt;/code&gt;.
     * @throws IllegalArgumentException
     *             if {@code roundingMode} does not represent a valid rounding
     *             mode.
     * @see BigDecimal
     */
    public BigDecimal bigDecimalValue(final int roundingMode) {
<span class="fc" id="L579">        return new BigDecimal(numerator).divide(new BigDecimal(denominator), roundingMode);</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction as a &lt;code&gt;BigDecimal&lt;/code&gt; following the passed scale
     * and rounding mode. This calculates the fraction as the numerator divided
     * by denominator.
     * &lt;/p&gt;
     *
     * @param scale
     *            scale of the &lt;code&gt;BigDecimal&lt;/code&gt; quotient to be returned.
     *            see {@link BigDecimal} for more information.
     * @param roundingMode
     *            rounding mode to apply. see {@link BigDecimal} constants.
     * @return the fraction as a &lt;code&gt;BigDecimal&lt;/code&gt;.
     * @see BigDecimal
     */
    public BigDecimal bigDecimalValue(final int scale, final int roundingMode) {
<span class="fc" id="L598">        return new BigDecimal(numerator).divide(new BigDecimal(denominator), scale, roundingMode);</span>
    }

    /**
     * &lt;p&gt;
     * Compares this object to another based on size.
     * &lt;/p&gt;
     *
     * @param object
     *            the object to compare to, must not be &lt;code&gt;null&lt;/code&gt;.
     * @return -1 if this is less than {@code object}, +1 if this is greater
     *         than {@code object}, 0 if they are equal.
     * @see java.lang.Comparable#compareTo(java.lang.Object)
     */
    @Override
    public int compareTo(final BigFraction object) {
<span class="fc" id="L614">        int lhsSigNum = numerator.signum();</span>
<span class="fc" id="L615">        int rhsSigNum = object.numerator.signum();</span>

<span class="pc bpc" id="L617" title="1 of 2 branches missed.">        if (lhsSigNum != rhsSigNum) {</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">            return (lhsSigNum &gt; rhsSigNum) ? 1 : -1;</span>
        }
<span class="pc bpc" id="L620" title="1 of 2 branches missed.">        if (lhsSigNum == 0) {</span>
<span class="nc" id="L621">            return 0;</span>
        }

<span class="fc" id="L624">        BigInteger nOd = numerator.multiply(object.denominator);</span>
<span class="fc" id="L625">        BigInteger dOn = denominator.multiply(object.numerator);</span>
<span class="fc" id="L626">        return nOd.compareTo(dOn);</span>
    }

    /**
     * &lt;p&gt;
     * Divide the value of this fraction by the passed {@code BigInteger},
     * ie {@code this * 1 / bg}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param bg the {@code BigInteger} to divide by, must not be {@code null}
     * @return a {@link BigFraction} instance with the resulting values
     * @throws NullArgumentException if the {@code BigInteger} is {@code null}
     * @throws MathArithmeticException if the fraction to divide by is zero
     */
    public BigFraction divide(final BigInteger bg) {
<span class="fc" id="L641">        MathUtils.checkNotNull(bg);</span>
<span class="pc bpc" id="L642" title="1 of 2 branches missed.">        if (bg.signum() == 0) {</span>
<span class="nc" id="L643">            throw new MathArithmeticException(LocalizedFormats.ZERO_DENOMINATOR);</span>
        }
<span class="pc bpc" id="L645" title="1 of 2 branches missed.">        if (numerator.signum() == 0) {</span>
<span class="nc" id="L646">            return ZERO;</span>
        }
<span class="fc" id="L648">        return new BigFraction(numerator, denominator.multiply(bg));</span>
    }

    /**
     * &lt;p&gt;
     * Divide the value of this fraction by the passed {@code int}, ie
     * {@code this * 1 / i}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param i the {@code int} to divide by
     * @return a {@link BigFraction} instance with the resulting values
     * @throws MathArithmeticException if the fraction to divide by is zero
     */
    public BigFraction divide(final int i) {
<span class="fc" id="L662">        return divide(BigInteger.valueOf(i));</span>
    }

    /**
     * &lt;p&gt;
     * Divide the value of this fraction by the passed {@code long}, ie
     * {@code this * 1 / l}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param l the {@code long} to divide by
     * @return a {@link BigFraction} instance with the resulting values
     * @throws MathArithmeticException if the fraction to divide by is zero
     */
    public BigFraction divide(final long l) {
<span class="fc" id="L676">        return divide(BigInteger.valueOf(l));</span>
    }

    /**
     * &lt;p&gt;
     * Divide the value of this fraction by another, returning the result in
     * reduced form.
     * &lt;/p&gt;
     *
     * @param fraction Fraction to divide by, must not be {@code null}.
     * @return a {@link BigFraction} instance with the resulting values.
     * @throws NullArgumentException if the {@code fraction} is {@code null}.
     * @throws MathArithmeticException if the fraction to divide by is zero
     */
    @Override
    public BigFraction divide(final BigFraction fraction) {
<span class="fc" id="L692">        MathUtils.checkNotNull(fraction, LocalizedFormats.FRACTION);</span>
<span class="fc bfc" id="L693" title="All 2 branches covered.">        if (fraction.numerator.signum() == 0) {</span>
<span class="fc" id="L694">            throw new MathArithmeticException(LocalizedFormats.ZERO_DENOMINATOR);</span>
        }
<span class="fc bfc" id="L696" title="All 2 branches covered.">        if (numerator.signum() == 0) {</span>
<span class="fc" id="L697">            return ZERO;</span>
        }

<span class="fc" id="L700">        return multiply(fraction.reciprocal());</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction as a {@code double}. This calculates the fraction as
     * the numerator divided by denominator.
     * &lt;/p&gt;
     *
     * @return the fraction as a {@code double}
     * @see java.lang.Number#doubleValue()
     */
    @Override
    public double doubleValue() {
<span class="fc" id="L714">        double result = numerator.doubleValue() / denominator.doubleValue();</span>
<span class="fc bfc" id="L715" title="All 2 branches covered.">        if (Double.isNaN(result)) {</span>
            // Numerator and/or denominator must be out of range:
            // Calculate how far to shift them to put them in range.
<span class="fc" id="L718">            int shift = FastMath.max(numerator.bitLength(),</span>
<span class="fc" id="L719">                                     denominator.bitLength()) - FastMath.getExponent(Double.MAX_VALUE);</span>
<span class="fc" id="L720">            result = numerator.shiftRight(shift).doubleValue() /</span>
<span class="fc" id="L721">                denominator.shiftRight(shift).doubleValue();</span>
        }
<span class="fc" id="L723">        return result;</span>
    }

    /**
     * &lt;p&gt;
     * Test for the equality of two fractions. If the lowest term numerator and
     * denominators are the same for both fractions, the two fractions are
     * considered to be equal.
     * &lt;/p&gt;
     *
     * @param other
     *            fraction to test for equality to this fraction, can be
     *            &lt;code&gt;null&lt;/code&gt;.
     * @return true if two fractions are equal, false if object is
     *         &lt;code&gt;null&lt;/code&gt;, not an instance of {@link BigFraction}, or not
     *         equal to this fraction instance.
     * @see java.lang.Object#equals(java.lang.Object)
     */
    @Override
    public boolean equals(final Object other) {
<span class="fc" id="L743">        boolean ret = false;</span>

<span class="fc bfc" id="L745" title="All 2 branches covered.">        if (this == other) {</span>
<span class="fc" id="L746">            ret = true;</span>
<span class="fc bfc" id="L747" title="All 2 branches covered.">        } else if (other instanceof BigFraction) {</span>
<span class="fc" id="L748">            BigFraction rhs = ((BigFraction) other).reduce();</span>
<span class="fc" id="L749">            BigFraction thisOne = this.reduce();</span>
<span class="pc bpc" id="L750" title="1 of 4 branches missed.">            ret = thisOne.numerator.equals(rhs.numerator) &amp;&amp; thisOne.denominator.equals(rhs.denominator);</span>
        }

<span class="fc" id="L753">        return ret;</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction as a {@code float}. This calculates the fraction as
     * the numerator divided by denominator.
     * &lt;/p&gt;
     *
     * @return the fraction as a {@code float}.
     * @see java.lang.Number#floatValue()
     */
    @Override
    public float floatValue() {
<span class="fc" id="L767">        float result = numerator.floatValue() / denominator.floatValue();</span>
<span class="fc bfc" id="L768" title="All 2 branches covered.">        if (Double.isNaN(result)) {</span>
            // Numerator and/or denominator must be out of range:
            // Calculate how far to shift them to put them in range.
<span class="fc" id="L771">            int shift = FastMath.max(numerator.bitLength(),</span>
<span class="fc" id="L772">                                     denominator.bitLength()) - FastMath.getExponent(Float.MAX_VALUE);</span>
<span class="fc" id="L773">            result = numerator.shiftRight(shift).floatValue() /</span>
<span class="fc" id="L774">                denominator.shiftRight(shift).floatValue();</span>
        }
<span class="fc" id="L776">        return result;</span>
    }

    /**
     * &lt;p&gt;
     * Access the denominator as a &lt;code&gt;BigInteger&lt;/code&gt;.
     * &lt;/p&gt;
     *
     * @return the denominator as a &lt;code&gt;BigInteger&lt;/code&gt;.
     */
    public BigInteger getDenominator() {
<span class="fc" id="L787">        return denominator;</span>
    }

    /**
     * &lt;p&gt;
     * Access the denominator as a {@code int}.
     * &lt;/p&gt;
     *
     * @return the denominator as a {@code int}.
     */
    public int getDenominatorAsInt() {
<span class="fc" id="L798">        return denominator.intValue();</span>
    }

    /**
     * &lt;p&gt;
     * Access the denominator as a {@code long}.
     * &lt;/p&gt;
     *
     * @return the denominator as a {@code long}.
     */
    public long getDenominatorAsLong() {
<span class="fc" id="L809">        return denominator.longValue();</span>
    }

    /**
     * &lt;p&gt;
     * Access the numerator as a &lt;code&gt;BigInteger&lt;/code&gt;.
     * &lt;/p&gt;
     *
     * @return the numerator as a &lt;code&gt;BigInteger&lt;/code&gt;.
     */
    public BigInteger getNumerator() {
<span class="fc" id="L820">        return numerator;</span>
    }

    /**
     * &lt;p&gt;
     * Access the numerator as a {@code int}.
     * &lt;/p&gt;
     *
     * @return the numerator as a {@code int}.
     */
    public int getNumeratorAsInt() {
<span class="fc" id="L831">        return numerator.intValue();</span>
    }

    /**
     * &lt;p&gt;
     * Access the numerator as a {@code long}.
     * &lt;/p&gt;
     *
     * @return the numerator as a {@code long}.
     */
    public long getNumeratorAsLong() {
<span class="fc" id="L842">        return numerator.longValue();</span>
    }

    /**
     * &lt;p&gt;
     * Gets a hashCode for the fraction.
     * &lt;/p&gt;
     *
     * @return a hash code value for this object.
     * @see java.lang.Object#hashCode()
     */
    @Override
    public int hashCode() {
<span class="fc" id="L855">        return 37 * (37 * 17 + numerator.hashCode()) + denominator.hashCode();</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction as an {@code int}. This returns the whole number part
     * of the fraction.
     * &lt;/p&gt;
     *
     * @return the whole number fraction part.
     * @see java.lang.Number#intValue()
     */
    @Override
    public int intValue() {
<span class="fc" id="L869">        return numerator.divide(denominator).intValue();</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction as a {@code long}. This returns the whole number part
     * of the fraction.
     * &lt;/p&gt;
     *
     * @return the whole number fraction part.
     * @see java.lang.Number#longValue()
     */
    @Override
    public long longValue() {
<span class="fc" id="L883">        return numerator.divide(denominator).longValue();</span>
    }

    /**
     * &lt;p&gt;
     * Multiplies the value of this fraction by the passed
     * &lt;code&gt;BigInteger&lt;/code&gt;, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param bg the {@code BigInteger} to multiply by.
     * @return a {@code BigFraction} instance with the resulting values.
     * @throws NullArgumentException if {@code bg} is {@code null}.
     */
    public BigFraction multiply(final BigInteger bg) {
<span class="fc" id="L897">        MathUtils.checkNotNull(bg);</span>
<span class="pc bpc" id="L898" title="2 of 4 branches missed.">        if (numerator.signum() == 0 || bg.signum() == 0) {</span>
<span class="nc" id="L899">            return ZERO;</span>
        }
<span class="fc" id="L901">        return new BigFraction(bg.multiply(numerator), denominator);</span>
    }

    /**
     * &lt;p&gt;
     * Multiply the value of this fraction by the passed {@code int}, returning
     * the result in reduced form.
     * &lt;/p&gt;
     *
     * @param i
     *            the {@code int} to multiply by.
     * @return a {@link BigFraction} instance with the resulting values.
     */
    @Override
    public BigFraction multiply(final int i) {
<span class="pc bpc" id="L916" title="2 of 4 branches missed.">        if (i == 0 || numerator.signum() == 0) {</span>
<span class="nc" id="L917">            return ZERO;</span>
        }

<span class="fc" id="L920">        return multiply(BigInteger.valueOf(i));</span>
    }

    /**
     * &lt;p&gt;
     * Multiply the value of this fraction by the passed {@code long},
     * returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param l
     *            the {@code long} to multiply by.
     * @return a {@link BigFraction} instance with the resulting values.
     */
    public BigFraction multiply(final long l) {
<span class="pc bpc" id="L934" title="2 of 4 branches missed.">        if (l == 0 || numerator.signum() == 0) {</span>
<span class="nc" id="L935">            return ZERO;</span>
        }

<span class="fc" id="L938">        return multiply(BigInteger.valueOf(l));</span>
    }

    /**
     * &lt;p&gt;
     * Multiplies the value of this fraction by another, returning the result in
     * reduced form.
     * &lt;/p&gt;
     *
     * @param fraction Fraction to multiply by, must not be {@code null}.
     * @return a {@link BigFraction} instance with the resulting values.
     * @throws NullArgumentException if {@code fraction} is {@code null}.
     */
    @Override
    public BigFraction multiply(final BigFraction fraction) {
<span class="fc" id="L953">        MathUtils.checkNotNull(fraction, LocalizedFormats.FRACTION);</span>
<span class="fc bfc" id="L954" title="All 2 branches covered.">        if (numerator.signum() == 0 ||</span>
<span class="fc bfc" id="L955" title="All 2 branches covered.">            fraction.numerator.signum() == 0) {</span>
<span class="fc" id="L956">            return ZERO;</span>
        }
<span class="fc" id="L958">        return new BigFraction(numerator.multiply(fraction.numerator),</span>
<span class="fc" id="L959">                               denominator.multiply(fraction.denominator));</span>
    }

    /**
     * &lt;p&gt;
     * Return the additive inverse of this fraction, returning the result in
     * reduced form.
     * &lt;/p&gt;
     *
     * @return the negation of this fraction.
     */
    @Override
    public BigFraction negate() {
<span class="fc" id="L972">        return new BigFraction(numerator.negate(), denominator);</span>
    }

    /**
     * &lt;p&gt;
     * Gets the fraction percentage as a {@code double}. This calculates the
     * fraction as the numerator divided by denominator multiplied by 100.
     * &lt;/p&gt;
     *
     * @return the fraction percentage as a {@code double}.
     */
    public double percentageValue() {
<span class="fc" id="L984">        return multiply(ONE_HUNDRED).doubleValue();</span>
    }

    /**
     * &lt;p&gt;
     * Returns a {@code BigFraction} whose value is
     * {@code (this&lt;sup&gt;exponent&lt;/sup&gt;)}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param exponent
     *            exponent to which this {@code BigFraction} is to be
     *            raised.
     * @return &lt;tt&gt;this&lt;sup&gt;exponent&lt;/sup&gt;&lt;/tt&gt;.
     */
    public BigFraction pow(final int exponent) {
<span class="fc bfc" id="L999" title="All 2 branches covered.">        if (exponent == 0) {</span>
<span class="fc" id="L1000">            return ONE;</span>
        }
<span class="pc bpc" id="L1002" title="1 of 2 branches missed.">        if (numerator.signum() == 0) {</span>
<span class="nc" id="L1003">            return this;</span>
        }

<span class="fc bfc" id="L1006" title="All 2 branches covered.">        if (exponent &lt; 0) {</span>
<span class="fc" id="L1007">            return new BigFraction(denominator.pow(-exponent), numerator.pow(-exponent));</span>
        }
<span class="fc" id="L1009">        return new BigFraction(numerator.pow(exponent), denominator.pow(exponent));</span>
    }

    /**
     * &lt;p&gt;
     * Returns a &lt;code&gt;BigFraction&lt;/code&gt; whose value is
     * &lt;tt&gt;(this&lt;sup&gt;exponent&lt;/sup&gt;)&lt;/tt&gt;, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param exponent
     *            exponent to which this &lt;code&gt;BigFraction&lt;/code&gt; is to be raised.
     * @return &lt;tt&gt;this&lt;sup&gt;exponent&lt;/sup&gt;&lt;/tt&gt; as a &lt;code&gt;BigFraction&lt;/code&gt;.
     */
    public BigFraction pow(final long exponent) {
<span class="fc bfc" id="L1023" title="All 2 branches covered.">        if (exponent == 0) {</span>
<span class="fc" id="L1024">            return ONE;</span>
        }
<span class="pc bpc" id="L1026" title="1 of 2 branches missed.">        if (numerator.signum() == 0) {</span>
<span class="nc" id="L1027">            return this;</span>
        }

<span class="fc bfc" id="L1030" title="All 2 branches covered.">        if (exponent &lt; 0) {</span>
<span class="fc" id="L1031">            return new BigFraction(ArithmeticUtils.pow(denominator, -exponent),</span>
<span class="fc" id="L1032">                                   ArithmeticUtils.pow(numerator,   -exponent));</span>
        }
<span class="fc" id="L1034">        return new BigFraction(ArithmeticUtils.pow(numerator,   exponent),</span>
<span class="fc" id="L1035">                               ArithmeticUtils.pow(denominator, exponent));</span>
    }

    /**
     * &lt;p&gt;
     * Returns a &lt;code&gt;BigFraction&lt;/code&gt; whose value is
     * &lt;tt&gt;(this&lt;sup&gt;exponent&lt;/sup&gt;)&lt;/tt&gt;, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param exponent
     *            exponent to which this &lt;code&gt;BigFraction&lt;/code&gt; is to be raised.
     * @return &lt;tt&gt;this&lt;sup&gt;exponent&lt;/sup&gt;&lt;/tt&gt; as a &lt;code&gt;BigFraction&lt;/code&gt;.
     */
    public BigFraction pow(final BigInteger exponent) {
<span class="fc bfc" id="L1049" title="All 2 branches covered.">        if (exponent.signum() == 0) {</span>
<span class="fc" id="L1050">            return ONE;</span>
        }
<span class="pc bpc" id="L1052" title="1 of 2 branches missed.">        if (numerator.signum() == 0) {</span>
<span class="nc" id="L1053">            return this;</span>
        }

<span class="fc bfc" id="L1056" title="All 2 branches covered.">        if (exponent.signum() == -1) {</span>
<span class="fc" id="L1057">            final BigInteger eNeg = exponent.negate();</span>
<span class="fc" id="L1058">            return new BigFraction(ArithmeticUtils.pow(denominator, eNeg),</span>
<span class="fc" id="L1059">                                   ArithmeticUtils.pow(numerator,   eNeg));</span>
        }
<span class="fc" id="L1061">        return new BigFraction(ArithmeticUtils.pow(numerator,   exponent),</span>
<span class="fc" id="L1062">                               ArithmeticUtils.pow(denominator, exponent));</span>
    }

    /**
     * &lt;p&gt;
     * Returns a &lt;code&gt;double&lt;/code&gt; whose value is
     * &lt;tt&gt;(this&lt;sup&gt;exponent&lt;/sup&gt;)&lt;/tt&gt;, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param exponent
     *            exponent to which this &lt;code&gt;BigFraction&lt;/code&gt; is to be raised.
     * @return &lt;tt&gt;this&lt;sup&gt;exponent&lt;/sup&gt;&lt;/tt&gt;.
     */
    public double pow(final double exponent) {
<span class="nc" id="L1076">        return FastMath.pow(numerator.doubleValue(),   exponent) /</span>
<span class="nc" id="L1077">               FastMath.pow(denominator.doubleValue(), exponent);</span>
    }

    /**
     * &lt;p&gt;
     * Return the multiplicative inverse of this fraction.
     * &lt;/p&gt;
     *
     * @return the reciprocal fraction.
     */
    @Override
    public BigFraction reciprocal() {
<span class="fc" id="L1089">        return new BigFraction(denominator, numerator);</span>
    }

    /**
     * &lt;p&gt;
     * Reduce this &lt;code&gt;BigFraction&lt;/code&gt; to its lowest terms.
     * &lt;/p&gt;
     *
     * @return the reduced &lt;code&gt;BigFraction&lt;/code&gt;. It doesn't change anything if
     *         the fraction can be reduced.
     */
    public BigFraction reduce() {
<span class="fc" id="L1101">        final BigInteger gcd = numerator.gcd(denominator);</span>

<span class="pc bpc" id="L1103" title="1 of 2 branches missed.">        if (BigInteger.ONE.compareTo(gcd) &lt; 0) {</span>
<span class="nc" id="L1104">            return new BigFraction(numerator.divide(gcd), denominator.divide(gcd));</span>
        } else {
<span class="fc" id="L1106">            return this;</span>
        }
    }

    /**
     * &lt;p&gt;
     * Subtracts the value of an {@link BigInteger} from the value of this
     * {@code BigFraction}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param bg the {@link BigInteger} to subtract, cannot be {@code null}.
     * @return a {@code BigFraction} instance with the resulting values.
     * @throws NullArgumentException if the {@link BigInteger} is {@code null}.
     */
    public BigFraction subtract(final BigInteger bg) {
<span class="nc" id="L1121">        MathUtils.checkNotNull(bg);</span>
<span class="nc bnc" id="L1122" title="All 2 branches missed.">        if (bg.signum() == 0) {</span>
<span class="nc" id="L1123">            return this;</span>
        }
<span class="nc bnc" id="L1125" title="All 2 branches missed.">        if (numerator.signum() == 0) {</span>
<span class="nc" id="L1126">            return new BigFraction(bg.negate());</span>
        }

<span class="nc" id="L1129">        return new BigFraction(numerator.subtract(denominator.multiply(bg)), denominator);</span>
    }

    /**
     * &lt;p&gt;
     * Subtracts the value of an {@code integer} from the value of this
     * {@code BigFraction}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param i the {@code integer} to subtract.
     * @return a {@code BigFraction} instance with the resulting values.
     */
    public BigFraction subtract(final int i) {
<span class="nc" id="L1142">        return subtract(BigInteger.valueOf(i));</span>
    }

    /**
     * &lt;p&gt;
     * Subtracts the value of a {@code long} from the value of this
     * {@code BigFraction}, returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param l the {@code long} to subtract.
     * @return a {@code BigFraction} instance with the resulting values.
     */
    public BigFraction subtract(final long l) {
<span class="nc" id="L1155">        return subtract(BigInteger.valueOf(l));</span>
    }

    /**
     * &lt;p&gt;
     * Subtracts the value of another fraction from the value of this one,
     * returning the result in reduced form.
     * &lt;/p&gt;
     *
     * @param fraction {@link BigFraction} to subtract, must not be {@code null}.
     * @return a {@link BigFraction} instance with the resulting values
     * @throws NullArgumentException if the {@code fraction} is {@code null}.
     */
    @Override
    public BigFraction subtract(final BigFraction fraction) {
<span class="fc" id="L1170">        MathUtils.checkNotNull(fraction, LocalizedFormats.FRACTION);</span>
<span class="fc bfc" id="L1171" title="All 2 branches covered.">        if (fraction.numerator.signum() == 0) {</span>
<span class="fc" id="L1172">            return this;</span>
        }
<span class="fc bfc" id="L1174" title="All 2 branches covered.">        if (numerator.signum() == 0) {</span>
<span class="fc" id="L1175">            return fraction.negate();</span>
        }

<span class="fc" id="L1178">        BigInteger num = null;</span>
<span class="fc" id="L1179">        BigInteger den = null;</span>
<span class="fc bfc" id="L1180" title="All 2 branches covered.">        if (denominator.equals(fraction.denominator)) {</span>
<span class="fc" id="L1181">            num = numerator.subtract(fraction.numerator);</span>
<span class="fc" id="L1182">            den = denominator;</span>
        } else {
<span class="fc" id="L1184">            num = (numerator.multiply(fraction.denominator)).subtract((fraction.numerator).multiply(denominator));</span>
<span class="fc" id="L1185">            den = denominator.multiply(fraction.denominator);</span>
        }
<span class="fc" id="L1187">        return new BigFraction(num, den);</span>

    }

    /**
     * &lt;p&gt;
     * Returns the &lt;code&gt;String&lt;/code&gt; representing this fraction, ie
     * &quot;num / dem&quot; or just &quot;num&quot; if the denominator is one.
     * &lt;/p&gt;
     *
     * @return a string representation of the fraction.
     * @see java.lang.Object#toString()
     */
    @Override
    public String toString() {
<span class="nc" id="L1202">        String str = null;</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">        if (BigInteger.ONE.equals(denominator)) {</span>
<span class="nc" id="L1204">            str = numerator.toString();</span>
<span class="nc bnc" id="L1205" title="All 2 branches missed.">        } else if (BigInteger.ZERO.equals(numerator)) {</span>
<span class="nc" id="L1206">            str = &quot;0&quot;;</span>
        } else {
<span class="nc" id="L1208">            str = numerator + &quot; / &quot; + denominator;</span>
        }
<span class="nc" id="L1210">        return str;</span>
    }

    /** {@inheritDoc} */
    @Override
    public BigFractionField getField() {
<span class="fc" id="L1216">        return BigFractionField.getInstance();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>